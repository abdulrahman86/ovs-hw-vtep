<?xml version="1.0" encoding="utf-8"?>
<database title="Hardware VTEP Schema">
  <p>
    This schema specifies relations that a VTEP can use to integrate
    physical ports into logical switches maintained by a network
    virtualization controller such as NVP.
  </p>
  
  <p>Glossary:</p>

  <dl>
    <dt>VTEP</dt>
    <dd>
      VXLAN Tunnel End Point, an entity which originates and/or terminates
      VXLAN tunnels.
    </dd>

    <dt>HSC</dt>
    <dd>
      Hardware Switch Controller.
    </dd>

    <dt>NVC</dt>
    <dd>
      Network Virtualization Controller, e.g. NVP.
    </dd>
  </dl>

  <table name="Global" title="Top-level configuration.">
    Top-level configuration for a hardware VTEP.  There must be
    exactly one record in the <ref table="Global"/> table.

    <column name="switches">
      The physical switches managed by the VTEP.
    </column>

    <group title="Database Configuration">
      <p>
        These columns primarily configure the Open vSwitch database
        (<code>ovsdb-server</code>), not the hardware VTEP itself.
      </p>

      <column name="managers">
        Database clients to which the Open vSwitch database server should
        connect or to which it should listen, along with options for how these
        connection should be configured.  See the <ref table="Manager"/> table
        for more information.
      </column>

      <column name="ssl">
        SSL configuration used by the database server.
      </column>
    </group>
  </table>

  <table name="Physical_Switch" title="A physical switch.">
    A physical switch within the domain of the VTEP.

    <column name="ports">
      The physical ports within the switch.
    </column>

    <group title="Identification">
      <column name="name">
	Symbolic name for the switch, such as its hostname.
      </column>
      
      <column name="description">
	An extended description for the switch, such as its switch login
	banner.
      </column>
    </group>
  </table>

  <table name="Physical_Port" title="A port within a physical switch.">
    A port within a <ref table="Physical_Switch"/>.

    <column name="vlan_to_logical_switch">
      Identifies a binding of logical switch to VLANs on the physical port.
      If, for example, the map contains a (VLAN, logical switch) pair, a
      packet that arrives on the port in the VLAN is considered to belong to
      the paired logical switch.
    </column>

    <group title="Identification">
      <column name="name">
	Symbolic name for the port.  The name ought to be unique within a given
	<ref table="Physical_Switch"/>, but the database is not capable of
	enforcing this.
      </column>
      
      <column name="description">
	An extended description for the port.
      </column>
    </group>
  </table>

  <table name="Logical_Switch" title="A layer-2 domain.">
    A logical Ethernet switch, whose implementation may span physical and
    virtual media, possibly crossing L3 domains via tunnels; a logical layer-2
    domain; an Ethernet broadcast domain.

    <column name="mac_locations">
      Identifies the physical location at which given Ethernet unicast,
      multicast, or broadcast addresses are known to reside, functioning in a
      way analogous to a MAC learning table for a logical switch.
    </column>

    <column name="ipv4_locations">
      Identifies the physical location at which given IPv4 addresses are known
      to reside, allowing for ARP suppression.
    </column>

    <column name="ipv6_locations">
      Identifies the physical location at which given IPv6 addresses are known
      to reside, allowing for IPv6 neighbor discovery suppression.
    </column>

    <group title="Identification">
      <column name="name">
	Symbolic name for the logical switch.
      </column>
      
      <column name="description">
	An extended description for the logical switch, such as its switch
	login banner.
      </column>
    </group>
  </table>

  <table name="Physical_Locator">
    A tunnel or some equivalent (e.g. collection of tunnels bundled together
    for robustness against failure).

    <column name="encapsulation_type">
      The type of tunneling encapsulation.
    </column>

    <column name="vtep_ip_address">
      For <code>vxlan_over_ipv4</code> encapsulation, the IPv4 address of the
      VXLAN tunnel endpoint.
    </column>

    <column name="vni">
      For <code>vxlan_over_ipv4</code> encapsulation, the VXLAN VNI.
    </column>
  </table>

  <table name="SSL">
    SSL configuration for the database server.

    <column name="private_key">
      Name of a PEM file containing the private key used as the switch's
      identity for SSL connections to the controller.
    </column>

    <column name="certificate">
      Name of a PEM file containing a certificate, signed by the
      certificate authority (CA) used by the controller and manager,
      that certifies the switch's private key, identifying a trustworthy
      switch.
    </column>

    <column name="ca_cert">
      Name of a PEM file containing the CA certificate used to verify
      that the switch is connected to a trustworthy controller.
    </column>

    <column name="bootstrap_ca_cert">
      If set to <code>true</code>, then the database server will attempt to
      obtain the CA certificate on its first SSL connection and save it to the
      named PEM file. If it is successful, it will immediately drop the
      connection and reconnect, and from then on all SSL connections must be
      authenticated by a certificate signed by the CA certificate thus
      obtained.  <em>This option exposes the SSL connection to a
      man-in-the-middle attack obtaining the initial CA certificate.</em> It
      may still be useful for bootstrapping.
    </column>
  </table>

</database>
